# -*- coding: utf-8 -*-
# ---------------------------------------------------------------------------
# Model_Ped-V-Car.py
# Created on: 2016-05-14 20:16:33.00000
#   (generated by ArcGIS/ModelBuilder)
# Usage: Model_Ped-V-Car <County> <Roads> <Collision_CSV> 
# Description: 
# ---------------------------------------------------------------------------

# Set the necessary product code
# import arcinfo


# Import arcpy module
import arcpy

# Set Geoprocessing environments
arcpy.env.scratchWorkspace = "T:\\Arcdata\\BoydsGIS\\_GEO409_2014\\L1\\CollisionTemp.gdb"
arcpy.env.workspace = "T:\\Arcdata\\BoydsGIS\\_GEO409_2014\\L1\\CollisionOuput.gdb"

# Script arguments
County = arcpy.GetParameterAsText(0)
if County == '#' or not County:
    County = "T:\\Arcdata\\BoydsGIS\\_GEO409_2014\\L1\\final.gdb\\FayetteCounty" # provide a default value if unspecified

Roads = arcpy.GetParameterAsText(1)
if Roads == '#' or not Roads:
    Roads = "T:\\Arcdata\\BoydsGIS\\_GEO409_2014\\L1\\final.gdb\\FayetteRoads" # provide a default value if unspecified

Collision_CSV = arcpy.GetParameterAsText(2)
if Collision_CSV == '#' or not Collision_CSV:
    Collision_CSV = "T:\\Arcdata\\BoydsGIS\\_GEO409_2014\\L1\\csv\\Collisions_201401291503131.csv" # provide a default value if unspecified

# Local variables:
Loc_Fayette_Event = Collision_CSV
Loc_Fayette = Loc_Fayette_Event
Ped_ALL = Loc_Fayette
Ped_ALL__3_ = Ped_ALL
Ped_intersectionStats = Ped_ALL__3_
CollisionsByIntersections_Output = Ped_intersectionStats
Ped_ALL__4_ = Ped_ALL
Ped_segmentStats = Ped_ALL__4_
CollisionsBySegment_Output = Ped_segmentStats
CollisionsBySegment = Ped_ALL
CollisionsByIntersection = CollisionsBySegment
CollisionTemp_gdb = "T:\\Arcdata\\BoydsGIS\\_GEO409_2014\\L1\\CollisionTemp.gdb"
CollisionOutput_gdb__2_ = "T:\\Arcdata\\BoydsGIS\\_GEO409_2014\\L1\\CollisionOutput.gdb"

# Process: Make XY Event Layer
tempEnvironment0 = arcpy.env.outputCoordinateSystem
arcpy.env.outputCoordinateSystem = "PROJCS['NAD_1983_StatePlane_Kentucky_FIPS_1600_Feet',GEOGCS['GCS_North_American_1983',DATUM['D_North_American_1983',SPHEROID['GRS_1980',6378137.0,298.257222101]],PRIMEM['Greenwich',0.0],UNIT['Degree',0.0174532925199433]],PROJECTION['Lambert_Conformal_Conic'],PARAMETER['False_Easting',4921250.0],PARAMETER['False_Northing',3280833.333333333],PARAMETER['Central_Meridian',-85.75],PARAMETER['Standard_Parallel_1',37.08333333333334],PARAMETER['Standard_Parallel_2',38.66666666666666],PARAMETER['Latitude_Of_Origin',36.33333333333334],UNIT['Foot_US',0.3048006096012192]]"
tempEnvironment1 = arcpy.env.geographicTransformations
arcpy.env.geographicTransformations = "NAD_1983_To_WGS_1984_1"
arcpy.MakeXYEventLayer_management(Collision_CSV, "GPS LONGITUDE DECIMAL", "GPS LATITUDE DECIMAL", Loc_Fayette_Event, "GEOGCS['GCS_WGS_1984',DATUM['D_WGS_1984',SPHEROID['WGS_1984',6378137.0,298.257223563]],PRIMEM['Greenwich',0.0],UNIT['Degree',0.0174532925199433]];-400 -400 1000000000;-100000 10000;-100000 10000;8.98315284119522E-09;0.001;0.001;IsHighPrecision", "")
arcpy.env.outputCoordinateSystem = tempEnvironment0
arcpy.env.geographicTransformations = tempEnvironment1

# Process: Feature Class to Feature Class
arcpy.FeatureClassToFeatureClass_conversion(Loc_Fayette_Event, CollisionTemp_gdb, "Loc_Fayette", "", "MASTER_FILE_NUMBER \"MASTER_FILE_NUMBER\" true true false 4 Long 0 0 ,First,#,,MASTER FILE NUMBER,-1,-1;INVESTIGATING_AGENCY \"INVESTIGATING_AGENCY\" true true false 255 Text 0 0 ,First,#,,INVESTIGATING AGENCY,-1,-1;LOCAL_CODE \"LOCAL_CODE\" true true false 255 Text 0 0 ,First,#,,LOCAL CODE,-1,-1;COLLISION_STATUS_CODE \"COLLISION_STATUS_CODE\" true true false 255 Text 0 0 ,First,#,,COLLISION STATUS CODE,-1,-1;COUNTY_NAME \"COUNTY_NAME\" true true false 4 Long 0 0 ,First,#,,COUNTY NAME,-1,-1;ROADWAY_NUMBER \"ROADWAY_NUMBER\" true true false 255 Text 0 0 ,First,#,,ROADWAY NUMBER,-1,-1;BLOCK_HOUSE__ \"BLOCK_HOUSE__\" true true false 4 Long 0 0 ,First,#,,BLOCK/HOUSE #,-1,-1;ROADWAY_NAME \"ROADWAY_NAME\" true true false 255 Text 0 0 ,First,#,,ROADWAY NAME,-1,-1;ROADWAY_SUFFIX \"ROADWAY_SUFFIX\" true true false 255 Text 0 0 ,First,#,,ROADWAY SUFFIX,-1,-1;ROADWAY_DIRECTION_CODE \"ROADWAY_DIRECTION_CODE\" true true false 255 Text 0 0 ,First,#,,ROADWAY DIRECTION CODE,-1,-1;GPS_LATITUDE_DECIMAL \"GPS_LATITUDE_DECIMAL\" true true false 8 Double 0 0 ,First,#,,GPS LATITUDE DECIMAL,-1,-1;GPS_LONGITUDE_DECIMAL \"GPS_LONGITUDE_DECIMAL\" true true false 8 Double 0 0 ,First,#,,GPS LONGITUDE DECIMAL,-1,-1;MILEPOINT_DERIVED \"MILEPOINT_DERIVED\" true true false 8 Double 0 0 ,First,#,,MILEPOINT DERIVED,-1,-1;COLLISION_DATE \"COLLISION_DATE\" true true false 8 Date 0 0 ,First,#,,COLLISION DATE,-1,-1;COLLISION_TIME \"COLLISION_TIME\" true true false 4 Long 0 0 ,First,#,,COLLISION TIME,-1,-1;INTERSECTION_ROADWAY__ \"INTERSECTION_ROADWAY__\" true true false 255 Text 0 0 ,First,#,,INTERSECTION ROADWAY #,-1,-1;INTERSECTION_ROADWAY_NAME \"INTERSECTION_ROADWAY_NAME\" true true false 255 Text 0 0 ,First,#,,INTERSECTION ROADWAY NAME,-1,-1;INTERSECTION_ROADWAY_SFX \"INTERSECTION_ROADWAY_SFX\" true true false 255 Text 0 0 ,First,#,,INTERSECTION ROADWAY SFX,-1,-1;BETWEEN_STREET_ROADWAY___1 \"BETWEEN_STREET_ROADWAY___1\" true true false 255 Text 0 0 ,First,#,,BETWEEN STREET ROADWAY # 1,-1,-1;BETWEEN_STREET_ROADWAY_NAME_1 \"BETWEEN_STREET_ROADWAY_NAME_1\" true true false 255 Text 0 0 ,First,#,,BETWEEN STREET ROADWAY NAME 1,-1,-1;BETWEEN_STREET_ROADWAY_SFX_1 \"BETWEEN_STREET_ROADWAY_SFX_1\" true true false 255 Text 0 0 ,First,#,,BETWEEN STREET ROADWAY SFX 1,-1,-1;BETWEEN_STREET_ROADWAY___2 \"BETWEEN_STREET_ROADWAY___2\" true true false 255 Text 0 0 ,First,#,,BETWEEN STREET ROADWAY # 2,-1,-1;BETWEEN_STREET_ROADWAY_NAME_2 \"BETWEEN_STREET_ROADWAY_NAME_2\" true true false 255 Text 0 0 ,First,#,,BETWEEN STREET ROADWAY NAME 2,-1,-1;BETWEEN_STREET_ROADWAY_SFX_2 \"BETWEEN_STREET_ROADWAY_SFX_2\" true true false 255 Text 0 0 ,First,#,,BETWEEN STREET ROADWAY SFX 2,-1,-1;UNITS_INVOLVED \"UNITS_INVOLVED\" true true false 4 Long 0 0 ,First,#,,UNITS INVOLVED,-1,-1;MOTOR_VEHICLES_INVOLVED \"MOTOR_VEHICLES_INVOLVED\" true true false 4 Long 0 0 ,First,#,,MOTOR VEHICLES INVOLVED,-1,-1;KILLED \"KILLED\" true true false 4 Long 0 0 ,First,#,,KILLED,-1,-1;INJURED \"INJURED\" true true false 4 Long 0 0 ,First,#,,INJURED,-1,-1;WEATHER_CODE \"WEATHER_CODE\" true true false 4 Long 0 0 ,First,#,,WEATHER CODE,-1,-1;WEATHER \"WEATHER\" true true false 255 Text 0 0 ,First,#,,WEATHER,-1,-1;ROADWAY_CONDITION_CODE \"ROADWAY_CONDITION_CODE\" true true false 4 Long 0 0 ,First,#,,ROADWAY CONDITION CODE,-1,-1;ROADWAY_CONDITION \"ROADWAY_CONDITION\" true true false 255 Text 0 0 ,First,#,,ROADWAY CONDITION,-1,-1;HIT___RUN_INDICATOR \"HIT___RUN_INDICATOR\" true true false 255 Text 0 0 ,First,#,,HIT & RUN INDICATOR,-1,-1;ROADWAY_TYPE_CODE \"ROADWAY_TYPE_CODE\" true true false 4 Long 0 0 ,First,#,,ROADWAY TYPE CODE,-1,-1;ROADWAY_TYPE \"ROADWAY_TYPE\" true true false 255 Text 0 0 ,First,#,,ROADWAY TYPE,-1,-1;DIRECTIONAL_ANALYSIS_CODE \"DIRECTIONAL_ANALYSIS_CODE\" true true false 4 Long 0 0 ,First,#,,DIRECTIONAL ANALYSIS CODE,-1,-1;DIRECTIONAL_ANALYSIS \"DIRECTIONAL_ANALYSIS\" true true false 255 Text 0 0 ,First,#,,DIRECTIONAL ANALYSIS,-1,-1;MANNER_OF_COLLISION_CODE \"MANNER_OF_COLLISION_CODE\" true true false 4 Long 0 0 ,First,#,,MANNER OF COLLISION CODE,-1,-1;MANNER_OF_COLLISION \"MANNER_OF_COLLISION\" true true false 255 Text 0 0 ,First,#,,MANNER OF COLLISION,-1,-1;ROADWAY_CHARACTER_CODE \"ROADWAY_CHARACTER_CODE\" true true false 4 Long 0 0 ,First,#,,ROADWAY CHARACTER CODE,-1,-1;ROADWAY_CHARACTER \"ROADWAY_CHARACTER\" true true false 255 Text 0 0 ,First,#,,ROADWAY CHARACTER,-1,-1;LIGHT_CONDITION_CODE \"LIGHT_CONDITION_CODE\" true true false 4 Long 0 0 ,First,#,,LIGHT CONDITION CODE,-1,-1;LIGHT_CONDITION \"LIGHT_CONDITION\" true true false 255 Text 0 0 ,First,#,,LIGHT CONDITION,-1,-1;RAMP_FROM_ROADWAY_ID \"RAMP_FROM_ROADWAY_ID\" true true false 255 Text 0 0 ,First,#,,RAMP FROM ROADWAY ID,-1,-1;RAMP_TO_ROADWAY_ID \"RAMP_TO_ROADWAY_ID\" true true false 255 Text 0 0 ,First,#,,RAMP TO ROADWAY ID,-1,-1;SECONDARY_COLLISION_INDICATOR \"SECONDARY_COLLISION_INDICATOR\" true true false 255 Text 0 0 ,First,#,,SECONDARY COLLISION INDICATOR,-1,-1", "")

# Process: Clip
arcpy.Clip_analysis(Loc_Fayette, County, Ped_ALL, "")

# Process: Feature Class to Feature Class (2)
arcpy.FeatureClassToFeatureClass_conversion(Roads, CollisionOutput_gdb__2_, "CollisionsBySegment", "", "RD_NAME \"RD_NAME\" true true false 240 Text 0 0 ,First,#,T:\\Arcdata\\BoydsGIS\\_GEO409_2014\\L1\\final.gdb\\FayetteRoads,RD_NAME,-1,-1;ROUTE_TYPE \"ROUTE_TYPE\" true true false 4 Text 0 0 ,First,#,T:\\Arcdata\\BoydsGIS\\_GEO409_2014\\L1\\final.gdb\\FayetteRoads,ROUTE_TYPE,-1,-1;ROUTE_LBL \"ROUTE_LBL\" true true false 9 Text 0 0 ,First,#,T:\\Arcdata\\BoydsGIS\\_GEO409_2014\\L1\\final.gdb\\FayetteRoads,ROUTE_LBL,-1,-1;SHIELD_LBL \"SHIELD_LBL\" true true false 6 Text 0 0 ,First,#,T:\\Arcdata\\BoydsGIS\\_GEO409_2014\\L1\\final.gdb\\FayetteRoads,SHIELD_LBL,-1,-1;Shape_Length \"Shape_Length\" false true true 8 Double 0 0 ,First,#,T:\\Arcdata\\BoydsGIS\\_GEO409_2014\\L1\\final.gdb\\FayetteRoads,Shape_Length,-1,-1", "")

# Process: Intersect
arcpy.Intersect_analysis("T:\\Arcdata\\BoydsGIS\\_GEO409_2014\\L1\\CollisionOutput.gdb\\CollisionsBySegment #", CollisionsByIntersection, "ALL", "", "POINT")

# Process: Near (2)
arcpy.Near_analysis(Ped_ALL, "T:\\Arcdata\\BoydsGIS\\_GEO409_2014\\L1\\CollisionOutput.gdb\\CollisionsBySegment", "", "NO_LOCATION", "NO_ANGLE", "PLANAR")

# Process: Summary Statistics (2)
arcpy.Statistics_analysis(Ped_ALL__4_, Ped_segmentStats, "KILLED SUM;INJURED SUM;COLLISION_TIME MEAN", "NEAR_FID")

# Process: Join Field (2)
arcpy.JoinField_management(CollisionsBySegment, "OBJECTID", Ped_segmentStats, "NEAR_FID", "FREQUENCY;SUM_KILLED;SUM_INJURED")

# Process: Near
arcpy.Near_analysis(Ped_ALL, "T:\\Arcdata\\BoydsGIS\\_GEO409_2014\\L1\\CollisionOutput.gdb\\CollisionsByIntersection", "", "NO_LOCATION", "NO_ANGLE", "PLANAR")

# Process: Summary Statistics
arcpy.Statistics_analysis(Ped_ALL__3_, Ped_intersectionStats, "KILLED SUM;INJURED SUM;COLLISION_TIME MEAN", "NEAR_FID")

# Process: Join Field
arcpy.JoinField_management(CollisionsByIntersection, "OBJECTID", Ped_intersectionStats, "NEAR_FID", "FREQUENCY;SUM_KILLED;SUM_INJURED")

